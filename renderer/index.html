<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="Content-Security-Policy" content="script-src 'self'; style-src 'self' 'unsafe-inline';" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sting AI Browser</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div id="app">
      <header id="header">
        <div id="tabBar" class="tabBar">
          <button
            id="tabsScrollLeftBtn"
            class="iconBtn tabScrollBtn"
            aria-label="Scroll tabs left"
            title="Scroll tabs left"
            data-i18n-attrs="aria-label:tabs.scrollLeft,title:tabs.scrollLeft"
          >
            ‹
          </button>
          <div
            id="tabStrip"
            class="tabStrip"
            role="tablist"
            aria-label="Tabs"
            data-i18n-attrs="aria-label:tabs.label"
          ></div>
          <button
            id="tabsScrollRightBtn"
            class="iconBtn tabScrollBtn"
            aria-label="Scroll tabs right"
            title="Scroll tabs right"
            data-i18n-attrs="aria-label:tabs.scrollRight,title:tabs.scrollRight"
          >
            ›
          </button>
          <button
            id="newTabBtn"
            class="iconBtn newTabBtn"
            aria-label="New tab"
            title="New tab"
            data-i18n-attrs="aria-label:tabs.new,title:tabs.new"
          >
            +
          </button>
        </div>

        <div id="toolbar" class="toolbar">
          <div class="navControls">
            <button
              id="backBtn"
              class="iconBtn"
              aria-label="Back"
              title="Back"
              data-i18n-attrs="aria-label:nav.back,title:nav.back"
            >
              ←
            </button>
            <button
              id="forwardBtn"
              class="iconBtn"
              aria-label="Forward"
              title="Forward"
              data-i18n-attrs="aria-label:nav.forward,title:nav.forward"
            >
              →
            </button>
            <button
              id="reloadBtn"
              class="iconBtn"
              aria-label="Reload"
              title="Reload"
              data-i18n-attrs="aria-label:nav.reload,title:nav.reload"
            >
              ⟳
            </button>
            <button
              id="homeBtn"
              class="iconBtn"
              aria-label="Home"
              title="Home"
              data-i18n-attrs="aria-label:nav.home,title:nav.home"
            >
              ⌂
            </button>
          </div>

          <div id="addressBar" class="addressBar">
            <div class="addressInner">
              <span id="addressStatusIcon" class="addressIcon" aria-hidden="true">🌐</span>
              <input
                id="urlInput"
                autocomplete="off"
                spellcheck="false"
                placeholder="Search or enter address"
                data-i18n-attrs="placeholder:address.placeholder"
              />
              <button
                id="clearUrlBtn"
                class="iconBtn clearBtn hidden"
                aria-label="Clear"
                title="Clear"
                data-i18n-attrs="aria-label:address.clear,title:address.clear"
              >
                ×
              </button>
            </div>
            <div
              id="suggestions"
              class="suggestions hidden"
              role="listbox"
              aria-label="Suggestions"
              data-i18n-attrs="aria-label:address.suggestions"
            ></div>
          </div>

          <div class="toolbarActions">
            <button
              id="aiToggleBtn"
              class="pillBtn"
              title="AI Assistant"
              aria-expanded="false"
              aria-controls="aiPanel"
              data-i18n-attrs="title:ai.label,aria-label:ai.label"
            >
              <span class="btnIcon" aria-hidden="true">✨</span>
              <span class="btnLabel" data-i18n="ai.label">AI Assistant</span>
            </button>
            <button
              id="aiSettingsBtn"
              class="iconBtn"
              type="button"
              aria-label="AI Assistant settings"
              title="AI Assistant settings"
              data-i18n-attrs="aria-label:ai.settings,title:ai.settings"
            >
              ⚙
            </button>
          </div>
        </div>

        <div id="loadingBar" class="loadingBar hidden" aria-hidden="true">
          <div id="loadingBarInner" class="loadingBarInner"></div>
        </div>
      </header>

      <div id="contentArea" class="contentArea">
        <div id="webviewArea" class="webviewArea"></div>

        <aside
          id="aiPanel"
          class="aiPanel hidden"
          aria-hidden="true"
          aria-label="AI Assistant"
          data-i18n-attrs="aria-label:ai.label"
        >
          <div
            id="aiResizeHandle"
            class="aiResizeHandle"
            role="separator"
            aria-orientation="vertical"
            tabindex="0"
            aria-label="Resize AI Assistant"
            data-i18n-attrs="aria-label:ai.resize"
          ></div>
          <div class="panelHeader aiPanelHeader">
            <div class="aiPanelHeaderTitle">
              <span class="aiPanelIcon" aria-hidden="true">✨</span>
              <span class="aiPanelHeaderText" data-i18n="ai.label">AI Assistant</span>
            </div>
            <div class="aiPanelHeaderActions">
              <button
                id="aiNewConversationBtn"
                class="iconBtn iconBtnSm"
                type="button"
                aria-label="New conversation"
                title="New conversation"
                data-i18n-attrs="aria-label:ai.newConversation,title:ai.newConversation"
              >
                +
              </button>
              <button
                id="aiHistoryBtn"
                class="iconBtn iconBtnSm"
                type="button"
                aria-label="Conversation history"
                title="Conversation history"
                data-i18n-attrs="aria-label:ai.history,title:ai.history"
              >
                🕒
              </button>
              <button
                id="aiCloseBtn"
                class="iconBtn iconBtnSm"
                type="button"
                aria-label="Close AI Assistant"
                title="Close"
                data-i18n-attrs="aria-label:ai.close,title:aiSettings.close"
              >
                ×
              </button>
            </div>
          </div>
          <div
            id="aiHistoryDrawer"
            class="aiHistoryDrawer hidden"
            aria-hidden="true"
            aria-label="AI Assistant history"
            data-i18n-attrs="aria-label:ai.history.title"
          >
            <div class="aiHistoryHeader">
              <div class="aiHistoryHeaderTitle">
                <span aria-hidden="true">🕒</span>
                <span data-i18n="ai.history.title">對話紀錄</span>
              </div>
              <button
                id="aiHistoryCloseBtn"
                class="iconBtn iconBtnSm"
                type="button"
                aria-label="Close history"
                title="Close history"
                data-i18n-attrs="aria-label:ai.history.close,title:ai.history.close"
              >
                ×
              </button>
            </div>
            <div
              id="aiHistoryList"
              class="aiHistoryList"
              aria-label="Conversation list"
              data-i18n-attrs="aria-label:ai.history.list"
            ></div>
          </div>
          <div class="aiChatLayout">
            <div class="contextCard aiChatContext">
              <div id="aiContextTitle" class="contextTitle"></div>
              <div id="aiContextUrl" class="contextUrl"></div>
            </div>

            <div
              id="aiChatMessages"
              class="aiChatMessages"
              aria-label="AI conversation"
              data-i18n-attrs="aria-label:ai.chat.aria"
            ></div>

            <div class="aiChatComposer">
              <div
                id="promptShortcuts"
                class="promptShortcuts"
                aria-label="Prompt shortcuts"
                data-i18n-attrs="aria-label:ai.prompts.shortcuts"
              ></div>

              <div class="aiComposerInputRow">
                <textarea
                  id="chatInput"
                  class="chatInput"
                  rows="3"
                  placeholder="輸入訊息…"
                  data-i18n-attrs="placeholder:ai.chat.placeholder"
                ></textarea>
                <button id="chatSendBtn" class="primaryBtn" type="button" data-i18n="ai.chat.send">送出</button>
              </div>
            </div>
          </div>
        </aside>
      </div>

      <footer id="statusBar" class="statusBar">
        <div id="statusText" class="statusLeft"></div>
        <div id="statusMeta" class="statusRight"></div>
      </footer>
    </div>

    <div id="aiSettingsModal" class="modalOverlay hidden" aria-hidden="true">
      <div class="modalCard" role="dialog" aria-modal="true" aria-labelledby="aiSettingsTitle">
        <div class="modalHeader">
          <div id="aiSettingsTitle" class="modalTitle" data-i18n="aiSettings.title">AI Assistant 設定</div>
          <button
            id="aiSettingsCloseBtn"
            class="iconBtn iconBtnSm"
            type="button"
            aria-label="Close settings"
            title="Close"
            data-i18n-attrs="aria-label:aiSettings.close,title:aiSettings.close"
          >
            ×
          </button>
        </div>

        <div class="modalBody">
          <div class="panelSection">
            <div class="panelSectionTitle" data-i18n="aiSettings.section.modelSource">模型來源</div>
            <div class="row">
              <label data-i18n="aiSettings.provider.label">Provider</label>
              <select id="providerSelect">
                <option value="local" data-i18n="aiSettings.provider.local">Local (Ollama)</option>
                <option value="gemini" data-i18n="aiSettings.provider.gemini">Gemini API</option>
              </select>
            </div>

            <div class="row" id="localModelRow">
              <label data-i18n="aiSettings.local.label">Local</label>
              <select id="localModelSelect"></select>
              <button id="refreshModelsBtn" data-i18n="aiSettings.refresh">刷新</button>
            </div>

            <div class="row" id="pullModelRow">
              <label data-i18n="aiSettings.pull.label">Pull</label>
              <input id="pullModelInput" />
              <button id="pullModelBtn" data-i18n="aiSettings.pull.button">下載模型</button>
            </div>

            <div class="panelSubSection hidden" id="geminiRow">
              <div class="row">
                <label data-i18n="aiSettings.gemini.model">Model</label>
                <select id="geminiModelSelect">
                  <option value="gemini-2.5-pro">gemini-2.5-pro</option>
                  <option value="gemini-2.5-flash" selected data-i18n="aiSettings.gemini.defaultModelOption">
                    gemini-2.5-flash (預設)
                  </option>
                  <option value="gemini-2.5-flash-preview-09-2025">gemini-2.5-flash-preview-09-2025</option>
                  <option value="gemini-2.5-flash-lite">gemini-2.5-flash-lite</option>
                  <option value="gemini-2.5-flash-lite-preview-09-2025">gemini-2.5-flash-lite-preview-09-2025</option>
                  <option value="gemini-2.5-flash-native-audio-preview-12-2025">
                    gemini-2.5-flash-native-audio-preview-12-2025
                  </option>
                  <option value="gemini-2.5-flash-preview-tts">gemini-2.5-flash-preview-tts</option>
                </select>
              </div>

              <div class="row">
                <label data-i18n="aiSettings.gemini.apiKey">API Key</label>
                <input
                  id="geminiApiKeyInput"
                  type="password"
                  autocomplete="off"
                  spellcheck="false"
                  placeholder="AIza…"
                />
                <button
                  id="toggleGeminiKeyBtn"
                  class="iconBtn iconBtnSm"
                  type="button"
                  aria-label="Toggle API key visibility"
                  title="Show/Hide"
                  data-i18n-attrs="aria-label:aiSettings.gemini.toggleKeyAria,title:aiSettings.gemini.toggleKey"
                >
                  👁
                </button>
              </div>

              <div class="row">
                <label></label>
                <small id="geminiKeyStatus" class="formHint" data-i18n="aiSettings.gemini.keyStatus.notSet">尚未設定</small>
              </div>

              <div class="row">
                <label></label>
                <button id="saveGeminiKeyBtn" type="button" data-i18n="aiSettings.gemini.keySave">儲存/更新</button>
                <button
                  id="clearGeminiKeyBtn"
                  type="button"
                  class="secondary"
                  data-i18n="aiSettings.gemini.keyClear"
                >
                  清除
                </button>
              </div>

              <div class="row hidden" id="geminiKeyErrorRow">
                <label></label>
                <div id="geminiKeyError" class="formError"></div>
              </div>
            </div>
          </div>

          <div class="panelSection">
            <div class="panelSectionTitle" data-i18n="aiSettings.section.context">上下文</div>
            <div class="row">
              <label data-i18n="aiSettings.context.label">內容</label>
              <select id="contextModeSelect">
                <option value="auto" data-i18n="aiSettings.context.auto">自動（有選取先用選取）</option>
                <option value="selection" data-i18n="aiSettings.context.selection">只用選取文字</option>
                <option value="page" data-i18n="aiSettings.context.page">整頁文字</option>
              </select>
            </div>
          </div>

          <div class="panelSection">
            <div class="panelSectionTitle" data-i18n="aiSettings.section.appearance">外觀</div>
            <div class="row">
              <label data-i18n="aiSettings.fontSize.label">字體</label>
              <select id="aiFontSizeSelect">
                <option value="1" data-i18n="aiSettings.fontSize.1">最小</option>
                <option value="2" data-i18n="aiSettings.fontSize.2">小</option>
                <option value="3" selected data-i18n="aiSettings.fontSize.3">標準</option>
                <option value="4" data-i18n="aiSettings.fontSize.4">大</option>
                <option value="5" data-i18n="aiSettings.fontSize.5">最大</option>
              </select>
            </div>
          </div>

          <div class="panelSection">
            <div class="panelSectionTitle" data-i18n="aiSettings.section.prompts">Prompts</div>
            <div class="row">
              <label data-i18n="aiSettings.prompt.label">Prompt</label>
              <select id="promptSelect"></select>
            </div>

            <div class="row">
              <label data-i18n="aiSettings.prompt.name">名稱</label>
              <input
                id="promptNameInput"
                placeholder="Prompt 名稱"
                data-i18n-attrs="placeholder:aiSettings.prompt.namePlaceholder"
              />
            </div>

            <div class="row">
              <label data-i18n="aiSettings.prompt.id">ID</label>
              <input id="promptIdInput" readonly />
            </div>

            <div class="row promptActions">
              <button id="addPromptBtn" data-i18n="aiSettings.prompt.add">新增</button>
              <button id="savePromptBtn" data-i18n="aiSettings.prompt.save">儲存</button>
              <button id="deletePromptBtn" data-i18n="aiSettings.prompt.delete">刪除</button>
              <button id="resetPromptsBtn" class="secondary" data-i18n="aiSettings.prompt.reset">重置預設</button>
            </div>

            <textarea
              id="customPromptInput"
              placeholder="可在這裡改寫 prompt..."
              data-i18n-attrs="placeholder:aiSettings.prompt.templatePlaceholder"
            ></textarea>
          </div>
        </div>
      </div>
    </div>

    <div id="appSettingsModal" class="modalOverlay hidden" aria-hidden="true">
      <div class="modalCard" role="dialog" aria-modal="true" aria-labelledby="appSettingsTitle">
        <div class="modalHeader">
          <div id="appSettingsTitle" class="modalTitle" data-i18n="appSettings.title">瀏覽器設定</div>
          <button
            id="appSettingsCloseBtn"
            class="iconBtn iconBtnSm"
            type="button"
            aria-label="Close browser settings"
            title="Close"
            data-i18n-attrs="aria-label:appSettings.close,title:appSettings.close"
          >
            ×
          </button>
        </div>

        <div class="modalBody">
          <div class="panelSection">
            <div class="panelSectionTitle" data-i18n="appSettings.section.appearance">外觀</div>
            <div class="row">
              <label data-i18n="appSettings.theme.label">主題</label>
              <select id="themeSelect">
                <option value="light" data-i18n="appSettings.theme.light">淺色</option>
                <option value="dark" data-i18n="appSettings.theme.dark">深色</option>
              </select>
            </div>
            <div class="row">
              <label data-i18n="appSettings.language.label">語系</label>
              <select id="languageSelect">
                <option value="zh-TW">繁體中文</option>
                <option value="en">English</option>
                <option value="es">Español</option>
              </select>
            </div>
          </div>

          <div class="panelSection">
            <div class="panelSectionTitle" data-i18n="appSettings.section.startup">啟動時</div>
            <div
              id="startupModeGroup"
              class="radioGroup"
              role="radiogroup"
              aria-label="Startup mode"
              data-i18n-attrs="aria-label:appSettings.startup.aria"
            >
              <label class="radioRow">
                <input type="radio" name="startupMode" value="home" />
                <span data-i18n="appSettings.startup.home">開啟首頁</span>
              </label>
              <label class="radioRow">
                <input type="radio" name="startupMode" value="continue" />
                <span data-i18n="appSettings.startup.continue">繼續上次瀏覽（實驗性）</span>
              </label>
              <label class="radioRow">
                <input type="radio" name="startupMode" value="urls" />
                <span data-i18n="appSettings.startup.urls">開啟特定頁面</span>
              </label>
            </div>
            <textarea
              id="startupUrlsInput"
              class="settingsTextarea"
              rows="4"
              placeholder="每行一個網址（僅支援 https/http）"
              data-i18n-attrs="placeholder:appSettings.startup.urlsPlaceholder"
            ></textarea>
            <small class="formHint" data-i18n="appSettings.startup.hint">
              提示：選擇「開啟特定頁面」時，會在每次啟動開啟這些網址。
            </small>
          </div>

          <div class="panelSection">
            <div class="panelSectionTitle" data-i18n="appSettings.section.home">首頁</div>
            <div class="row">
              <label data-i18n="appSettings.home.url">網址</label>
              <input id="homePageInput" placeholder="https://example.com" />
              <button id="saveHomePageBtn" data-i18n="appSettings.home.apply">套用</button>
            </div>
          </div>

          <div class="panelSection">
            <div class="panelSectionTitle" data-i18n="appSettings.section.search">搜尋引擎</div>
            <div class="row">
              <label data-i18n="appSettings.search.default">預設</label>
              <select id="searchEngineSelect">
                <option value="google">Google</option>
                <option value="bing">Bing</option>
                <option value="duckduckgo">DuckDuckGo</option>
                <option value="custom" data-i18n="appSettings.search.custom">自訂</option>
              </select>
            </div>
            <div class="row" id="searchEngineTemplateRow">
              <label data-i18n="appSettings.search.template">模板</label>
              <input id="searchEngineTemplateInput" placeholder="https://...{query}..." />
              <button id="saveSearchTemplateBtn" data-i18n="appSettings.home.apply">套用</button>
            </div>
            <small class="formHint">
              <span data-i18n="appSettings.search.templateHint.prefix">自訂模板需包含 </span>
              <code>{query}</code>
              <span data-i18n="appSettings.search.templateHint.suffix">，會自動用關鍵字取代。</span>
            </small>
          </div>

          <div class="panelSection">
            <div class="panelSectionTitle" data-i18n="appSettings.section.privacy">隱私</div>
            <div class="row">
              <label></label>
              <button id="clearHistoryBtn" class="secondary" data-i18n="appSettings.privacy.clearHistory">
                清除瀏覽紀錄
              </button>
            </div>
          </div>

          <div class="panelSection">
            <div class="panelSectionTitle" data-i18n="appSettings.section.import">匯入</div>
            <div class="row">
              <label></label>
              <button id="importChromeBtn" data-i18n="appSettings.import.chrome">從 Chrome 匯入</button>
              <small id="importChromeStatus" class="formHint"></small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="historyModal" class="modalOverlay hidden" aria-hidden="true">
      <div class="modalCard" role="dialog" aria-modal="true" aria-labelledby="historyTitle">
        <div class="modalHeader">
          <div id="historyTitle" class="modalTitle" data-i18n="history.title">歷史紀錄</div>
          <button
            id="historyCloseBtn"
            class="iconBtn iconBtnSm"
            type="button"
            aria-label="Close history"
            title="Close"
            data-i18n-attrs="aria-label:history.close,title:history.close"
          >
            ×
          </button>
        </div>

        <div class="modalBody">
          <div class="row">
            <label data-i18n="history.search.label">搜尋</label>
            <input id="historySearchInput" placeholder="搜尋標題或網址..." data-i18n-attrs="placeholder:history.search.placeholder" />
            <button id="historyClearBtn" class="secondary" data-i18n="history.clear">清除</button>
          </div>
          <div id="historyList" class="historyList" aria-label="History list"></div>
        </div>
      </div>
    </div>

    <div id="chromeImportModal" class="modalOverlay hidden" aria-hidden="true">
      <div class="modalCard compactModalCard" role="dialog" aria-modal="true" aria-labelledby="chromeImportTitle">
        <div class="modalHeader">
          <div id="chromeImportTitle" class="modalTitle" data-i18n="chromeImport.title">從 Chrome 匯入設定？</div>
          <button
            id="chromeImportCloseBtn"
            class="iconBtn iconBtnSm"
            type="button"
            aria-label="Close import"
            title="Close"
            data-i18n-attrs="aria-label:chromeImport.close,title:chromeImport.close"
          >
            ×
          </button>
        </div>

        <div class="modalBody">
          <div class="importIntro">
            <div class="panelSectionTitle" data-i18n="chromeImport.firstLaunch">第一次啟動</div>
            <p class="formHint" data-i18n="chromeImport.intro">
              你可以從 Chrome 匯入常用設定，讓使用體驗更接近原本的瀏覽器。
            </p>
            <ul class="importList">
              <li data-i18n="chromeImport.item.home">首頁網址</li>
              <li data-i18n="chromeImport.item.search">預設搜尋引擎</li>
              <li data-i18n="chromeImport.item.startup">啟動時行為（開啟特定頁面/繼續上次瀏覽）</li>
            </ul>
            <small id="chromeImportHint" class="formHint"></small>
          </div>

          <div class="actions">
            <button id="chromeImportSkipBtn" class="secondary" data-i18n="chromeImport.skip">略過</button>
            <button id="chromeImportConfirmBtn" data-i18n="chromeImport.import">匯入</button>
          </div>
        </div>
      </div>
    </div>

    <div id="dragShield" class="dragShield hidden" aria-hidden="true"></div>

    <script src="./renderer.js"></script>
  </body>
</html>
